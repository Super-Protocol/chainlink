C4Component
    title Component Diagram - Price Aggregator Architecture

    Boundary(pa, "Price Aggregator") {
        Component(controller, "Quotes Controller", "REST API", "Exposes /quotes endpoints")
        Component(batch, "Batch Quotes Service", "Business Logic", "Handles batch quote requests")
        Component(cache, "Cache Service", "Storage", "In-memory cache with TTL")
        Component(staleness, "Cache Staleness Service", "Monitoring", "Detects stale entries")
        Component(refetch, "Refetch Service", "Automation", "Pre-fetches before expiry")
        Component(cleanup, "Pair Cleanup Service", "Maintenance", "Removes inactive pairs")
        Component(streaming, "Streaming Quotes Service", "WebSocket", "Real-time price streams")
        Component(sources, "Data Source Adapters", "Integration", "13+ source connectors")
        Component(metrics_svc, "Metrics Service", "Observability", "Prometheus metrics")
        Component(push, "Push Metrics Service", "Telemetry", "Pushes to remote Prometheus")
    }

    Component_Ext(ext_sources, "External Data Sources", "Binance, OKX, CoinGecko, etc.")
    Component_Ext(prometheus, "Prometheus/VictoriaMetrics", "Metrics storage")

    Rel(controller, batch, "Uses")
    Rel(batch, cache, "Read/Write")
    Rel(batch, sources, "Fetches missing")
    Rel(sources, ext_sources, "HTTP/WSS")
    Rel(staleness, cache, "Monitors")
    Rel(staleness, refetch, "Triggers")
    Rel(refetch, sources, "Fetches")
    Rel(refetch, cache, "Updates")
    Rel(cleanup, cache, "Removes")
    Rel(streaming, sources, "Subscribes")
    Rel(streaming, cache, "Updates")
    Rel(metrics_svc, push, "Collects")
    Rel(push, prometheus, "Pushes")
